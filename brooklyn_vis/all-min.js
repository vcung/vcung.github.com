function init(){setFirstMap(),setIncomeMap(),setEducationMap(),setDemMap(race),$(".slider").slick({dots:!0,infinite:!0,speed:300,slidesToShow:1,adaptiveHeight:!1,arrows:!0,draggable:!1})}function setFirstMap(){width=400,height=400,border=1,bordercolor="black",path=d3.geo.path(),svg=d3.select("#brooklynMap").append("svg").attr("width",width).attr("height",height).attr("border",border),file2000="ct2000/allnyc2000geo.json",file2010="ct2010/allnycgeo.json",loadFirstMapData()}function loadFirstMapData(){queue().defer(d3.json,file2000).defer(d3.json,file2010).await(processData)}function processData(){}function clicked(e){if(active.node()===this)return reset();if(void 0!==active&&null!==active[0][0]){var t=active[0][0].__data__.properties.classVal;d3.select(active[0][0]).text(function(e){void 0!==e&&e.properties.ct==active[0][0].__data__.properties.ct&&d3.select(this).attr("class",t)})}active.classed("active",!1),active=d3.select(this).classed("active",!0);var a=path.bounds(e),s=a[1][0]-a[0][0],n=a[1][1]-a[0][1],r=(a[0][0]+a[1][0])/2,i=(a[0][1]+a[1][1])/2,c=.15/Math.max(s/width,n/height),o=[width/2-c*r,height/2-c*i];currentID=$(this.parentNode.parentNode).attr("class");var l=null;switch(currentID){case"income":buildIncomeGraphs(active),l=income2000_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event),l=income2010_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event);break;case"education":buildEducationGraphs(active),l=edu2000_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event),l=edu2010_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event);break;case"demographics":buildDemographicGraphs(active),l=dem2000_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event),l=dem2010_svg,l.transition().duration(750).call(zoom.translate(o).scale(c).event);break;default:l=null}d3.select(this).attr("class","tract-highlight")}function reset(){var e=null;switch(currentID){case"income":e=income2000_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),e=income2010_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),resetIncomeGraphs();break;case"education":e=edu2000_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),e=edu2010_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),resetEducationGraphs();break;case"demographics":e=dem2000_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),e=dem2010_svg,e.transition().duration(750).call(zoom.translate([0,0]).scale(1).event),resetDemGraphs();break;default:e=null}var t=active[0][0].__data__.properties.classVal;d3.select(active[0][0]).text(function(e){void 0!==e&&e.properties.ct==active[0][0].__data__.properties.ct&&d3.select(this).attr("class",t)}),active.classed("active",!1),active=d3.select(null)}function zoomed(){currentID=$(this).attr("class");var e=null;switch(currentID){case"income":g1.style("stroke-width",1.5/d3.event.scale+"px"),g1.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),g2.style("stroke-width",1.5/d3.event.scale+"px"),g2.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");break;case"education":g3.style("stroke-width",1.5/d3.event.scale+"px"),g3.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),g4.style("stroke-width",1.5/d3.event.scale+"px"),g4.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");break;case"demographics":demG1.style("stroke-width",1.5/d3.event.scale+"px"),demG1.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),demG2.style("stroke-width",1.5/d3.event.scale+"px"),demG2.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");break;default:e=null}}function stopped(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function updateDemMaps(e){race=e;var t=(topojson.feature(demCSV2000,demCSV2000.objects.tracts),topojson.feature(demCSV2010,demCSV2010.objects.tracts),d3.scale.quantize().domain([demMaxMin2010[0],demMaxMin2010[1]]).range(d3.range(demQuantizeRange).map(function(e){return"d"+e})));demG1.selectAll("path").attr("class",function(e){return createDemTractClass(e,t,demData2000,race)}),demG2.selectAll("path").attr("class",function(e){return createDemTractClass(e,t,demData2010,race)})}var width,height,border,bordercolor,path,svg,file2000,file2010,active,zoom,income2010,income2000,income2000_svg,income2010_svg,maxMin2000,maxMin2010,quantizeRange,off,s,projection,zoom,g1,g2,currentID,income2000ID,income2010ID,income2000legend,income2010legend,incomeColor,edu2000,edu2010,edu2000_svg,edu2010_svg,edu2000ID,edu2010ID,g3,g4,eduColor,demData2010,demData2000,dem2000_svg,dem2010_svg,demG1,demG2,demMaxMin2000,demMaxMin2010,demQuantizeRange,demOff,demS,demProjection,demZoom,demCurrentID,dem2000ID,dem2010ID,dem2000legend,dem2010legend,demColor,demCSV2000,demCSV2010,race="white",legendRectSize=18,legendSpacing=4,iter=0;$(".race_btn").on("click",function(){var e=$(this).attr("id").toLowerCase();$("p span").html(e[0].toUpperCase()+e.substring(1,e.length)),updateDemMaps(e)});
function setIncomeMap(){income2000="",income2010="",quantizeRange=9,incomeColor=d3.scale.category20b().domain(d3.range(quantizeRange-1)),console.log(incomeColor.domain().length),active=d3.select(null),off=[width/2,height/2],s=14e4,projection=d3.geo.mercator().scale(s).center([-73.938,40.6545]).translate(off),zoom=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",zoomed),width=550,height=350,path.projection(projection),income2000_svg=d3.select("#data2000").append("svg").attr("class","income").attr("width",width).attr("height",height).attr("border",border).attr("align","center").on("click",stopped,!0),income2010_svg=d3.select("#data2010").append("svg").attr("class","income").attr("width",width).attr("height",height).attr("border",border).attr("align","center").on("click",stopped,!0),income2000_svg.append("rect").attr("class","background").attr("height",height).attr("width",width).on("click",reset),income2010_svg.append("rect").attr("class","background").attr("height",height).attr("width",width).on("click",reset),graph1=d3.select("#graph2000").append("div").attr("id","dataGraph1").attr("float","left").attr("width",500).attr("height",200),graph2=d3.select("#graph2010").append("div").attr("float","left").attr("id","dataGraph2").attr("width",500).attr("height",200),g1=income2000_svg.append("g").attr("width",width).attr("height",height),g2=income2010_svg.append("g").attr("width",width).attr("height",height),income2000_svg.call(zoom).call(zoom.event),income2010_svg.call(zoom).call(zoom.event),loadIncomeMapData()}function loadIncomeMapData(){queue().defer(d3.json,file2000).defer(function(e,t){d3.csv(e,function(e){return{id:e.GEOid,geography:e.GEOdisplay_label,num_hd:e.HC01_VC02,avg_hd_income:e.HC01_VC20}},function(e,t){income2000=t,maxMinMedian2000=getIncomeInfo(income2000)}),t()},"Average_Income/incomeCensus2000_2.csv").defer(d3.json,file2010).defer(function(e,t){d3.csv(e,function(e){return{id:e.GEOid,geography:e.GEOdisplay_label,num_hd:e.HC01_EST_VC02,avg_hd_income:e.HC02_EST_VC02}},function(e,t){income2010=t,maxMinMedian2010=getIncomeInfo(income2010)}),t()},"Average_Income/incomeCensus2010_2.csv").await(processIncomeData)}function processIncomeData(e,t,a,n){return e?console.error(e):(processIncome2000(t),void processIncome2010(n))}function processIncome2000(e){{var t=topojson.feature(e,e.objects.tracts).features,a=d3.scale.quantize().domain([maxMinMedian2000[0],maxMinMedian2000[1]]).range(d3.range(quantizeRange).map(function(e){return"q"+e}));income2000_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}g1.selectAll("path").data(t).enter().append("path").attr("class",function(e){return createTractClass(e,a,income2000,!1)}).on("click",clicked).attr("d",path),iter=1,income2000legend=income2000_svg.selectAll(".legend").data(incomeColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){var a=legendRectSize+legendSpacing,n=(a*incomeColor.domain().length/2,width-legendRectSize-90),r=t*a+10;return"translate("+n+","+r+")"}),income2000legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){return num=iter,iter++,"q"+num}),iter=1,income2000legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).text(function(){switch(iter){case 1:minRange=0,maxRange="1k";break;case 2:minRange="10k",maxRange="25k";break;case 3:minRange="25k",maxRange="50k";break;case 4:minRange="50k",maxRange="75k";break;case 5:minRange="75k",maxRange="100k";break;case 6:minRange="100k",maxRange="150k";break;case 7:minRange="150k",maxRange="200k";break;case 8:minRange="200k",maxRange=">"}return iter++,minRange+" - "+maxRange})}function processIncome2010(e){{var t=topojson.feature(e,e.objects.tracts).features,a=d3.scale.quantize().domain([maxMinMedian2010[0],maxMinMedian2010[1]]).range(d3.range(quantizeRange).map(function(e){return"q"+e}));income2010_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}g2.selectAll("path").data(t).enter().append("path").attr("class",function(e){return createTractClass(e,a,income2010,!0)}).on("click",clicked).attr("d",path),iter=1,income2010legend=income2010_svg.selectAll(".legend").data(incomeColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){var a=legendRectSize+legendSpacing,n=(a*incomeColor.domain().length/2,width-legendRectSize-90),r=t*a+10;return"translate("+n+","+r+")"}),income2010legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){return num=iter,iter++,"q"+num}),iter=1,income2010legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).text(function(){switch(iter){case 1:minRange=0,maxRange="1k";break;case 2:minRange="10k",maxRange="25k";break;case 3:minRange="25k",maxRange="50k";break;case 4:minRange="50k",maxRange="75k";break;case 5:minRange="75k",maxRange="100k";break;case 6:minRange="100k",maxRange="150k";break;case 7:minRange="150k",maxRange="200k";break;case 8:minRange="200k",maxRange=">"}return iter++,minRange+" - "+maxRange})}function createTractClass(e,t,a,n){if(3!=e.id)return e.properties.classVal="tract","tract";for(i=0;i<a.length;i++){var r=a[i].geography,o=a[i].avg_hd_income;if(r=r.match(/Census Tract (.*?),/)[1],r==e.properties.ct){if(e.properties.income=a[i],"-"==o||isNaN(o))return e.properties.classVal="q9","q9";e.properties.year=n?2010:2e3;var c=getClassValue(o);return e.properties.classVal=c,c}}return e.properties.classVal="tract","tract"}function buildIncomeGraphs(e){console.log(e);var t=maxMinMedian2000[2],a=maxMinMedian2010[2],n=e[0][0].__data__.properties.income.avg_hd_income,r=e[0][0].__data__.properties.ct,i=e[0][0].__data__.properties.year;if(2e3==i)for(var o=0;o<income2010.length;o++){var c=income2010[o].geography;c=c.match(/Census Tract (.*?),/)[1],c==r&&(tractIncome2010=parseFloat(income2010[o].avg_hd_income),tractIncome2000=parseFloat(n))}else for(var o=0;o<income2000.length;o++){var c=income2000[o].geography;c=c.match(/Census Tract (.*?),/)[1],c==r&&(tractIncome2000=parseFloat(income2000[o].avg_hd_income),tractIncome2010=parseFloat(n))}{var s=Math.max(t,a,tractIncome2000,tractIncome2010);new Highcharts.Chart({chart:{type:"column",renderTo:"dataGraph1",width:400,height:250},title:{text:"Average Household Income, 2000"},subtitle:{text:"Source: US Census, 2000"},xAxis:{categories:[""]},yAxis:{min:0,max:s,title:{text:"Household Income (Dollars)"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.1f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Brooklyn Average",data:[t]},{name:"This Tract",data:[tractIncome2000]}]}),new Highcharts.Chart({chart:{type:"column",renderTo:"dataGraph2",width:400,height:250},title:{text:"Average Household Income, 2010"},subtitle:{text:"Source: US Census, 2010"},xAxis:{categories:[""]},yAxis:{min:0,max:s,title:{text:"Household Income (Dollars)"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.1f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Brooklyn Average",data:[a]},{name:"This Tract",data:[tractIncome2010]}]})}}function resetIncomeGraphs(){graph1[0][0].innerHTML=null,graph2[0][0].innerHTML=null}function getClassValue(e){switch(!0){case e>0&&1e4>=e:return"q1";case e>1e4&&25e3>e:return"q2";case e>=25e3&&5e4>e:return"q3";case e>=5e4&&75e3>e:return"q4";case e>=75e3&&1e5>e:return"q5";case e>=1e5&&15e4>e:return"q6";case e>=15e4&&2e5>e:return"q7";case e>=2e5:return"q8";default:return"q9"}}function findDumbo(){}var graph1,graph2;
function setEducationMap(){active=d3.select(null),eduColor=eduColor=d3.scale.category20b().domain(d3.range(5)),off=[width/2,height/2],s=14e4,projection=d3.geo.mercator().scale(s).center([-73.938,40.6545]).translate(off),zoom=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",zoomed),path.projection(projection),edu2000_svg=d3.select("#eduData2000").append("svg").attr("class","education").attr("width",width).attr("height",height).attr("align","center").on("click",stopped,!0),edu2010_svg=d3.select("#eduData2010").append("svg").attr("class","education").attr("width",width).attr("height",height).attr("border",border).attr("align","center").on("click",stopped,!0),edu2000_svg.append("rect").attr("class","background").attr("width",width).attr("height",height).on("click",reset),edu2010_svg.append("rect").attr("class","background").attr("height",height).attr("width",width).on("click",reset),eduGraph1=d3.select("#eduGraph2000").append("div").attr("id","eduDataGraph1").attr("float","left").attr("width",500).attr("height",200),eduGraph2=d3.select("#eduGraph2010").append("div").attr("id","eduDataGraph2").attr("float","left").attr("width",500).attr("height",200),g3=edu2000_svg.append("g").attr("width",width).attr("height",height),g4=edu2010_svg.append("g").attr("width",width).attr("height",height),edu2000_svg.call(zoom).call(zoom.event),edu2010_svg.call(zoom).call(zoom.event),loadEducationMap()}function loadEducationMap(){queue().defer(d3.json,file2000).defer(function(e,t){d3.csv(e,function(e){return{id:e.GEOdisplay_label.match(/Census Tract (.*?),/)[1],geoId:e.GEOid,geography:e.GEOdisplay_label,pop_25_older:e.pop_25_older,edu_9_12_25_older:e.edu_9_12_25_older,edu_high_25_older:e.edu_high_25_older,edu_some_coll_25_older:e.edu_some_coll_25_older,edu_associates_25_older:e.edu_associates_25_older,edu_bachelors_25_older:e.edu_bachelors_25_older}},function(e,t){edu2000=t}),t()},"education/2000education.csv").defer(d3.json,file2010).defer(function(e,t){d3.csv(e,function(e){return{id:e.GEOdisplay_label.match(/Census Tract (.*?),/)[1],geoId:e.GEOid,geography:e.GEOdisplay_label,pop_25_older:e.total_pop_25_older,edu_9_12_25_older:e.edu_9_12_no_diploma_25_older,edu_high_25_older:e.edu_high_25_older,edu_some_coll_25_older:e.edu_some_coll_25_older,edu_associates_25_older:e.edu_associates_25_older,edu_bachelors_25_older:e.edu_bachelors_25_older}},function(e,t){edu2010=t}),t()},"education/2010education.csv").await(processEducationData)}function processEducationData(e,t,a,r){return e?console.log(e):(processEducation2000(t),void processEducation2010(r))}function processEducation2000(e){{var t=topojson.feature(e,e.objects.tracts).features;edu2000_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}g3.selectAll("path").data(t).enter().append("path").attr("class",function(e){return createEducationTractClass(e,edu2000,!1)}).on("click",clicked).attr("d",path),legend=edu2000_svg.selectAll(".legend").data(eduColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){var a=legendRectSize+legendSpacing,r=(a*eduColor.domain().length/2,width-115-legendRectSize),o=t*a+10;return"translate("+r+","+o+")"}),iter=1,legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){switch(iter++){case 1:return"edu_9_12_25_older";case 2:return"edu_high_25_older";case 3:return"edu_some_coll_25_older";case 4:return"edu_associates_25_older";case 5:return"edu_bachelors_25_older"}}),iter=1,legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).text(function(){switch(iter++){case 1:return"No HS Diploma";case 2:return"High School";case 3:return"Some College";case 4:return"Associates";case 5:return"Bachelors"}})}function processEducation2010(e){{var t=topojson.feature(e,e.objects.tracts).features;edu2010_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}g4.selectAll("path").data(t).enter().append("path").attr("class",function(e){return createEducationTractClass(e,edu2010,!0)}).on("click",clicked).attr("d",path),legend=edu2010_svg.selectAll(".legend").data(eduColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){var a=legendRectSize+legendSpacing,r=(a*eduColor.domain().length/2,width-115-legendRectSize),o=t*a+10;return"translate("+r+","+o+")"}),iter=1,legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){switch(iter++){case 1:return"edu_9_12_25_older";case 2:return"edu_high_25_older";case 3:return"edu_some_coll_25_older";case 4:return"edu_associates_25_older";case 5:return"edu_bachelors_25_older"}}),iter=1,legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).text(function(){switch(iter++){case 1:return"No HS Diploma";case 2:return"High School";case 3:return"Some College";case 4:return"Associates";case 5:return"Bachelors"}})}function createEducationTractClass(e,t,a){if(3!=e.id)return e.properties.classVal="tract","tract";for(var r=0;r<t.length;r++){var o=t[r].id;if(o==e.properties.ct){e.properties.education=t[r];var d=getEducationInfo(e.properties.education);return void 0===d?(e.properties.classVal="tract","tract"):(e.properties.year=a?2010:2e3,e.properties.classVal=d,d)}}return e.properties.classVal="tract","tract"}function resetEducationGraphs(){eduGraph1[0][0].innerHTML=null,eduGraph2[0][0].innerHTML=null}function buildEducationGraphs(e){var t=e[0][0].__data__.properties.education,a=e[0][0].__data__.properties.ct,r=e[0][0].__data__.properties.year;if(2e3==r)for(var o=0;o<edu2010.length;o++){var d=edu2010[o].geography;d=d.match(/Census Tract (.*?),/)[1],d==a&&(tractEducationBreakdown2010=edu2010[o],tractEducationBreakdown2000=t)}else for(var o=0;o<edu2000.length;o++){var d=edu2000[o].geography;d=d.match(/Census Tract (.*?),/)[1],d==a&&(tractEducationBreakdown2000=edu2000[o],tractEducationBreakdown2010=t)}{var n=parseInt(tractEducationBreakdown2000.edu_9_12_25_older),c=parseInt(tractEducationBreakdown2000.edu_high_25_older),l=parseInt(tractEducationBreakdown2000.edu_some_coll_25_older),i=parseInt(tractEducationBreakdown2000.edu_associates_25_older),s=parseInt(tractEducationBreakdown2000.edu_bachelors_25_older),u=parseInt(tractEducationBreakdown2010.edu_9_12_25_older),_=parseInt(tractEducationBreakdown2010.edu_high_25_older),h=parseInt(tractEducationBreakdown2010.edu_some_coll_25_older),p=parseInt(tractEducationBreakdown2010.edu_associates_25_older),g=parseInt(tractEducationBreakdown2010.edu_bachelors_25_older);new Highcharts.Chart({chart:{plotBackgroundColor:null,plotBorderWidth:1,plotShadow:!1,width:450,align:"center",height:250,renderTo:"eduDataGraph1"},title:{text:"Education Data, 2000"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Education Level by Census Tract",data:[["No HS Diploma",n],["High School Diploma",c],["Some College",l],["Associates Degree",i],["Bachelors Degree",s]]}]}),new Highcharts.Chart({chart:{plotBackgroundColor:null,plotBorderWidth:1,plotShadow:!1,width:450,align:"center",height:250,renderTo:"eduDataGraph2"},title:{text:"Education Data, 2010"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Education Level by Census Tract",data:[["No HS Diploma",u],["High School Diploma",_],["Some College",h],["Associates Degree",p],["Bachelors Degree",g]]}]})}}var eduGraph1,eduGraph2;
function getMaxOfArray(e){return Math.max.apply(null,e)}function getKeyByValue(e,n){for(var r in n)if(n.hasOwnProperty(r)&&n[r]==e)return r}function getIncomeInfo(e){for(var n=-1/0,r=1/0,a=0;a<e.length;a++)parseInt(e[a].avg_hd_income)>n?n=parseInt(e[a].avg_hd_income):parseInt(e[a].avg_hd_income)<r&&(r=parseInt(e[a].avg_hd_income));e.sort(function(e,n){return e.avg_hd_income-n.avg_hd_income});var o=parseInt(e.length/2),t=parseInt(e[o].avg_hd_income);return[r,n,t]}function getEducationInfo(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&("edu_9_12_25_older"===r||"edu_associates_25_older"===r||"edu_bachelors_25_older"===r||"edu_high_25_older"===r||"edu_some_coll_25_older"===r)&&n.push(e[r]);var a=getMaxOfArray(n);return getKeyByValue(a,e)}function getDemInfo(){return[0,100]}var max,min;
function setDemMap(){demQuantizeRange=9,active=d3.select(null),demColor=d3.scale.category20b().domain(d3.range(demQuantizeRange)),demOff=[width/2,height/2],demS=14e4,projection=d3.geo.mercator().scale(s).center([-73.938,40.6545]).translate(off),zoom=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",zoomed),path.projection(projection),dem2000_svg=d3.select("#demData2000").append("svg").attr("class","demographics").attr("width",width).attr("height",height).attr("border",border).attr("align","center").on("click",stopped,!0),dem2010_svg=d3.select("#demData2010").append("svg").attr("class","demographics").attr("width",width).attr("height",height).attr("border",border).attr("align","center").on("click",stopped,!0),dem2000_svg.append("rect").attr("class","background").attr("height",height).attr("width",width).on("click",reset),dem2010_svg.append("rect").attr("class","background").attr("height",height).attr("width",width).on("click",reset),demGraph1=d3.select("#demGraph2000").append("div").attr("id","demDataGraph1").attr("float","left").attr("width",500).attr("height",200),demGraph2=d3.select("#demGraph2010").append("div").attr("id","demDataGraph2").attr("float","left").attr("width",500).attr("height",200),demG1=dem2000_svg.append("g").attr("width",width).attr("height",height),demG2=dem2010_svg.append("g").attr("width",width).attr("height",height),dem2000_svg.call(zoom).call(zoom.event),dem2010_svg.call(zoom).call(zoom.event),loadDemMapData(race)}function loadDemMapData(e){race=e,queue().defer(d3.json,file2000).defer(function(e,a){d3.csv(e,function(e){return{id:e.GEOid,geography:e.GEOdisplay_label.match(/Census Tract (.*?),/)[1],total_ppl:e.HC01_VC01,white:e.HC02_VC29,black:e.HC02_VC30,indian_alaskan:e.HC02_VC31,asian:e.HC02_VC32,hawaiian_pacific:e.HC02_VC40,other:e.HC02_VC45,multiple:e.HC02_VC46,hispanic:e.HC02_VC56}},function(e,a){demData2000=a,demMaxMin2000=getDemInfo(demData2000,race)}),a()},"demData/2000demographic.csv").defer(d3.json,file2010).defer(function(e,a){d3.csv(e,function(e){return{id:e.GEOid,geography:e.GEOdisplay_label.match(/Census Tract (.*?),/)[1],total_ppl:e.HD01_S076,white:e.HD02_S078,black:e.HD02_S079,indian_alaskan:e.HD02_S080,asian:e.HD02_S081,hawaiian_pacific:e.HD02_S089,other:e.HD02_S094,multiple:e.HD02_S095,hispanic:e.HD02_S114}},function(e,a){demData2010=a,demMaxMin2010=getDemInfo(demData2010,race)}),a()},"demData/2010demographic.csv").await(processDemData)}function processDemData(e,a,t,r){return e?console.error(e):(demCSV2000=a,demCSV2010=r,processDem2000(a),void processDem2010(r))}function processDem2000(e){{var a=topojson.feature(e,e.objects.tracts),t=d3.scale.quantize().domain([demMaxMin2000[0],demMaxMin2000[1]]).range(d3.range(demQuantizeRange).map(function(e){return"d"+e}));dem2000_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}demG1.selectAll("path").data(a.features).enter().append("path").attr("class",function(e){return createDemTractClass(e,t,demData2000,race,!1)}).on("click",clicked).attr("d",path),dem2000legend=dem2000_svg.selectAll(".legend").data(demColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,a){var t=legendRectSize+legendSpacing,r=(t*demColor.domain().length/2,width-90-legendRectSize),n=a*t+10;return"translate("+r+","+n+")"}),iter=1,dem2000legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){return num=iter,iter++,t(num/demQuantizeRange*demMaxMin2000[1])}),iter=1,dem2000legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).data(a.features).text(function(){minRange=(iter-1)/demQuantizeRange*demMaxMin2000[1],maxRange=iter/demQuantizeRange*demMaxMin2000[1],0>iter&&(minRange=0);var e=minRange.toFixed(0)+"% - "+maxRange.toFixed(0)+"%";return iter++,e})}function processDem2010(e){{var a=topojson.feature(e,e.objects.tracts),t=d3.scale.quantize().domain([demMaxMin2010[0],demMaxMin2010[1]]).range(d3.range(demQuantizeRange).map(function(e){return"d"+e}));dem2010_svg.append("rect").attr("x",1).attr("y",1).attr("height",height-2).attr("width",width-2).attr("class","rect-border").style("fill","None")}demG2.selectAll("path").data(a.features).enter().append("path").attr("class",function(e){return createDemTractClass(e,t,demData2010,race,!0)}).on("click",clicked).attr("d",path),dem2010legend=dem2010_svg.selectAll(".legend").data(demColor.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,a){var t=legendRectSize+legendSpacing,r=(t*demColor.domain().length/2,width-90-legendRectSize),n=a*t+10;return"translate("+r+","+n+")"}),iter=1,dem2010legend.append("rect").attr("width",legendRectSize).attr("height",legendRectSize).style("stroke","#000").attr("class",function(){return num=iter,iter++,t(num/demQuantizeRange*demMaxMin2000[1])}),iter=1,dem2010legend.append("text").attr("x",legendRectSize+legendSpacing).attr("y",legendRectSize-legendSpacing).data(a.features).text(function(){minRange=(iter-1)/demQuantizeRange*demMaxMin2000[1],maxRange=iter/demQuantizeRange*demMaxMin2000[1],0>iter&&(minRange=0);var e=minRange.toFixed(0)+"% - "+maxRange.toFixed(0)+"%";return iter++,e})}function createDemTractClass(e,a,t,r,n){if(3!=e.id)return e.properties.classVal="tract","tract";var d;for(i=0;i<t.length;i++){var c=t[i].geography;if(d=getDemographic(t[i],r),parseFloat(c)==parseFloat(e.properties.ct)){if(e.properties.demographic=t[i],"-"==d||isNaN(d))return e.properties.classVal="d9","d9";e.properties.year=n?2010:2e3;var o=a(parseFloat(d));return e.properties.classVal=o,o}}}function getDemographic(e,a){switch(a){case"white":dem=e.white;break;case"black":dem=e.black;break;case"indian_alaskan":dem=e.indian_alaskan;break;case"asian":dem=e.asian;break;case"hawaiian_pacific":dem=e.hawaiian_pacific;break;case"other":dem=e.other;break;case"multiple":dem=e.multiple;break;case"hispanic":dem=e.hispanic}return dem}function buildDemographicGraphs(e){var a=e[0][0].__data__.properties.demographic,t=e[0][0].__data__.properties.ct,r=e[0][0].__data__.properties.year;if(2e3==r)for(var n=0;n<demData2010.length;n++){var i=demData2010[n].geography;i==t&&(tractRaceBreakdown2010=demData2010[n],tractRaceBreakdown2000=a)}else for(var n=0;n<demData2000.length;n++){var i=demData2000[n].geography;i==t&&(tractRaceBreakdown2000=demData2000[n],tractRaceBreakdown2010=a)}{var d=parseFloat(tractRaceBreakdown2000.white),c=parseFloat(tractRaceBreakdown2000.black),o=parseFloat(tractRaceBreakdown2000.asian),l=parseFloat(tractRaceBreakdown2000.hispanic),s=100-(d+c+o+l),p=parseFloat(tractRaceBreakdown2010.white),m=parseFloat(tractRaceBreakdown2010.black),h=parseFloat(tractRaceBreakdown2010.asian),g=parseFloat(tractRaceBreakdown2010.hispanic),u=100-(p+m+h+g);new Highcharts.Chart({chart:{plotBackgroundColor:null,plotBorderWidth:1,plotShadow:!1,width:400,align:"center",height:250,renderTo:"demDataGraph1"},title:{text:"Demographic Data, 2000"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Racial Breakdown by Census Tract",data:[["White",d],["Black",c],["Asian",o],["Hispanic",l],["Others",s]]}]}),new Highcharts.Chart({chart:{plotBackgroundColor:null,plotBorderWidth:1,plotShadow:!1,width:400,align:"center",height:250,renderTo:"demDataGraph2"},title:{text:"Demographic Data, 2010"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Racial Breakdown by Census Tract",data:[["White",p],["Black",m],["Asian",h],["Hispanic",g],["Others",u]]}]})}}function resetDemGraphs(){demGraph1[0][0].innerHTML=null,demGraph2[0][0].innerHTML=null}var demGraph1,demGraph2;
